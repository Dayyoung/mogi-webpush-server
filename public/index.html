<html>
  <head>
    <title>Web Push Service</title>
    <meta name="viewport" content="width=device-width, initial-scale=1 , viewport-fit=cover">
    <link rel="stylesheet" href="/stylesheets/style.css" />
    <link rel="manifest" href="/manifest.json">

  </head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="
  https://cdn.jsdelivr.net/npm/jquery-loadingModal@1.0.2/js/jquery.loadingModal.min.js
  "></script>
  <link href="
  https://cdn.jsdelivr.net/npm/jquery-loadingModal@1.0.2/css/jquery.loadingModal.min.css
  " rel="stylesheet">

    <script src="/js/webpush-client.js"></script>
    <script>


function goRegist(){

  var PushClient;
        if (WebPushClientFactory.isSupported()) {
            WebPushClientFactory.create({
                serviceWorkerPath: '/js/webpush-sw1.js', // Public path to the service worker
                serverKey: 'BH46BdRrMgRmRwgTDArIX8yOC9GxTJMUnTn557z0yN40Qk1VSMrr0SCBXa5N6qABxy7y6eocrtBbdpp3SWsTUgw', // https://developers.google.com/web/fundamentals/push-notifications/web-push-protocol#application_server_keys
                //subscribeUrl: 'http://localhost:8080/sendEmail', // Optionnal - your application URL to store webpush subscriptions
            })
                .then(Client => {
                    PushClient = Client;
                    console.log(PushClient);
                    PushClient.subscribe().then(Subscription => {
                      console.log(JSON.stringify(Subscription));
                      

                     var subscribeString = JSON.stringify(Subscription);
                      console.log(subscribeString)
                      var requestUrl = "https://docs.google.com/forms/u/0/d/e/1FAIpQLSeh83n8A7DJ1DtBtzODWNQ5qWbAsf__xj7LNFlNJXHpkOwMxw/formResponse?entry.1882051254="+subscribeString
                      $.get(requestUrl)
                      //$('<iframe id="myFrame" style="display:none" onload="loadCompted();" src="'+requestUrl+'" frameborder="0" scrolling="no"></iframe>').appendTo('body');

                    })
                })
            ;
        }
}

function goUnRegist(){
 
  var PushClient;
        if (WebPushClientFactory.isSupported()) {
            WebPushClientFactory.create({
                serviceWorkerPath: '/js/webpush-sw1.js', // Public path to the service worker
                serverKey: 'BH46BdRrMgRmRwgTDArIX8yOC9GxTJMUnTn557z0yN40Qk1VSMrr0SCBXa5N6qABxy7y6eocrtBbdpp3SWsTUgw', // https://developers.google.com/web/fundamentals/push-notifications/web-push-protocol#application_server_keys
                //subscribeUrl: 'http://localhost:8080/sendEmail', // Optionnal - your application URL to store webpush subscriptions
            })
                .then(Client => {
                    PushClient = Client;
                    console.log(PushClient);
                    PushClient.subscribe().then(Subscription => {
                      console.log(JSON.stringify(Subscription));
                     var subscribeString = JSON.stringify(Subscription);
                      console.log(subscribeString)
                      var requestUrl = "https://docs.google.com/forms/u/0/d/e/1FAIpQLSeceGol5sqAORDs-g0YPyrjwXTTgfFRsZ2hLpNgTlgspHEdog/formResponse?entry.1882051254="+subscribeString
                      $.get(requestUrl)
                      

                    })
                })
            ;
        }
}

function goPush(){
        var PushClient;
        if (WebPushClientFactory.isSupported()) {
            WebPushClientFactory.create({
                serviceWorkerPath: '/js/webpush-sw1.js', // Public path to the service worker
                serverKey: 'BH46BdRrMgRmRwgTDArIX8yOC9GxTJMUnTn557z0yN40Qk1VSMrr0SCBXa5N6qABxy7y6eocrtBbdpp3SWsTUgw', // https://developers.google.com/web/fundamentals/push-notifications/web-push-protocol#application_server_keys
                //subscribeUrl: 'http://localhost:8080/sendEmail', // Optionnal - your application URL to store webpush subscriptions
            })
                .then(Client => {
                    PushClient = Client;
                    console.log(PushClient);
                    PushClient.subscribe().then(Subscription => {
                    console.log(JSON.stringify(Subscription));
                    var requestUrl = './sendPush';
                    var subscribeJson = JSON.parse(JSON.stringify(Subscription));
                    $.get(requestUrl,subscribeJson);
                    })
                })
            ;
        }
}

    </script>
  <body>
  	<center>
    <h1>Web Push Service</h1><br><br><br>
<p>Regist :</p>    
<button class="button" onclick="goRegist()"><span>Regist Push! ðŸ””</span></button>
<p>Un-regist :</p>    
<button class="button" onclick="goUnRegist()"><span>Un-regist Push! ðŸ””</span></button>
<p>Send Now :</p>    
<button class="button" onclick="goPush()"><span>Send Now! ðŸ””</span></button>

</center>
<style>

.button {
  display: inline-block;
  border-radius: 4px;
  background-color: #f4511e;
  border: none;
  color: #FFFFFF;
  text-align: center;
  font-size: 18px;
  padding: 20px;
  width: 200px;
  transition: all 0.5s;
  cursor: pointer;
  margin: 5px;
}

.button span {
  cursor: pointer;
  display: inline-block;
  position: relative;
  transition: 0.5s;
}

.button span:after {
  content: '\00bb';
  position: absolute;
  opacity: 0;
  top: 0;
  right: -20px;
  transition: 0.5s;
}

.button:hover span {
  padding-right: 25px;
}

</stle>  

	</center>
  </body>
</html>

